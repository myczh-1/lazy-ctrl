lazy-ctrl 功能模块规划文档

## 1. 控制器 Agent（Go 实现）
位置：本地电脑，负责执行脚本和提供通信接口。

### - 命令注册/管理：支持注册常用命令或脚本（如 mute、shutdown）
  - 功能目标：
    - 支持用户将常用系统脚本（如 mute、shutdown）注册为命令 ID；
    - 提供统一调用接口（本地 CLI / 远程调用均可使用）；
    - 后期支持 Web 页面管理这些命令。

  - 技术实现：
    - 使用本地 JSON 配置文件（如 `commands.json`）注册命令 ID → 脚本路径；
    - Go 启动时读取并缓存配置；
    - 后期支持由本地配置服务动态热更新。

### - 命令执行器：执行本地脚本或系统指令，支持参数传递
  - 功能目标：
    - 统一封装系统调用执行入口；
    - 支持命令行参数传入，适配多样化场景；
    - 输出标准输出/错误并返回执行状态。

### - 状态反馈：返回脚本执行结果、输出、是否成功等
  - 功能目标：
    - 所有执行请求返回标准化响应结构：是否成功 + 输出文本；
    - 支持本地 CLI 打印、远程调用回传结构体；
    - 后期可扩展日志记录机制。

### - 本地通信接口：提供 gRPC 或 HTTP 接口供 Node 层或远程调用
  - 功能目标：
    - 提供统一的 `ExecuteCommand` 接口服务；
    - gRPC 为默认实现，未来可扩展 HTTP 接口兼容更多场景；
    - 本地通信推荐采用 Unix socket，跨平台时可自动 fallback 为 TCP。

### - 安全限制（可选）：限制可执行脚本、路径隔离、执行白名单等
  - 功能目标：
    - 限定允许执行的脚本路径；
    - 可配置命令白名单；
    - 后期可集成用户权限、PIN 校验机制等。

---

## 2. 本地配置服务（Node.js + Midway 实现）
位置：用于管理本地脚本配置，提供 REST API 给前端控制端调用。

### - 脚本管理 API：添加、修改、删除本地控制脚本
  - 提供标准 RESTful 接口；
  - 修改本地 `commands.json` 配置文件并热更新。

### - 配置持久化：将配置写入 JSON、数据库或本地文件
  - 默认写入本地 JSON 文件，后期可扩展 SQLite / 文件系统存储；
  - 自动同步修改到 Go 控制器。

### - 控制中转接口：接收来自前端的控制请求并调用 Go 控制器
  - 作为 Web 前端和控制器的桥梁；
  - 调用本地 gRPC 接口转发命令请求。

### - 用户界面支持：给前端提供接口获取脚本列表、执行状态等
  - 提供 GET 接口查询命令元数据、执行日志等；
  - 接口结构标准化，方便前端对接。

### - 本地认证（可选）：支持 PIN 或本地密码校验
  - 启用后需要验证 PIN 才能控制电脑；
  - 提升安全性，避免误操作。

---

## 3. 控制前端（Taro + 微信小程序/H5 实现）
位置：终端控制界面，用户通过手机操作本地电脑

### - 脚本控制页面：展示当前可用脚本，点击执行
  - UI 列表展示所有已注册脚本；
  - 点击发送控制请求到本地服务。

### - 状态反馈：展示执行结果、是否成功、输出日志等
  - 实时展示脚本执行状态与输出反馈；
  - 支持错误提示与重试机制。

### - 控制模式切换：本地控制 / 云端远程控制切换入口
  - 显示连接状态；
  - 提供连接本地与云端设备的入口与切换。

### - 配置界面（可选）：允许用户修改脚本别名、图标等元数据
  - 编辑脚本名、图标、快捷入口；
  - 调用本地配置服务完成更新。

---

## 4. 云端中转服务（可选，Node.js 实现）
位置：用户在公网控制本地设备时用作账号验证、消息转发。

### - 用户认证：支持微信登录、设备绑定、多人共享
  - 实现 OAuth 登录；
  - 支持绑定设备到用户账号。

### - 设备注册：本地控制器 Agent 可注册设备 ID 并与用户关联
  - 支持设备名称、描述、状态等字段；
  - 可通过扫码等方式完成绑定。

### - 控制转发：将前端命令转发至对应 Agent
  - 云端存储设备在线状态 / 通道；
  - 实现按用户 ID → 设备 ID → 通道消息转发。

### - 状态上报中转：Agent 执行结果由云端转发回前端
  - 云端负责回传执行响应；
  - 前端统一接收状态。

### - 实时连接支持：通过 WebSocket 或 gRPC streaming 长连接通信
  - 云端与 Agent 建立长连接；
  - 支持消息推送、命令推送、断线重连等机制。